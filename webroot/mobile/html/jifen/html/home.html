<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="format-detection" content="telephone=no, email=no" />
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <title>换积分了-个人主页</title>
        <link rel="stylesheet" type="text/css" href="../css/basic.css"/>
        <link rel="stylesheet" type="text/css" href="../css/style.css"/>
        <script src="../js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../js/style.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" src="../js/des.js"></script>
    </head>
    <body>
        <header style="height: 173px;padding: 0;">
            <div class="inner">
                <h1 class="home_head" style="font-size: 22px;"><span class='title'>换积分了</span><a href="javascript:location.href='login.html?channelId='+$.func.getUrlParam('channelId')" class="quit_login fr">退出登录</a></h1>
                <div class="home_user_info">
                    <span class="imginfo"><img src="../images/tx.png" id="avatar" style="width: 76px; height: 75px;"/></span>
                    <div class="home_head_info">
                        <a href="javascript:void(0)" class="mobilenum" id="nickName" style="font-size: 19px;"></a>
                        <h1 style="font-size: 15px;margin: 20px 0 0 2px;text-align: left;padding-left: 29px;"><span id="jifen">0</span> 换呗</h1>
                    </div>
                    <a href="javascript:location.href='guide.html?channelId='+$.func.getUrlParam('channelId')" style="float: right;margin-top: 25px;">
                        <img src='../images/newuser.png' style="width: 63px;" />
                    </a>
                </div>
            </div>
        </header>
        <div class="wraper">
            <div class="home_item">
                <div class="itemtitle" style="margin-top: 4px;">
                    <div style="width: 3px;height: 16px;background-color: #01c6fa;float: left;position: relative;top: 13px;left: 12px;"></div>
                    <div class="inner clearfix" style="border-bottom:1px #ddd solid;border-top:1px #ddd solid;background-color: white;">
                        <span class="fl item_title_r_name" style="font-size: 16px;">兑换商品</span>
                        <a href="javascript:location.href='allgoods.html?channelId='+$.func.getUrlParam('channelId')" class="fr color_items more" >查看更多</a>
                    </div>
                </div>
                <div class="items_con" id="product">
                </div>
            </div>
            <div class="home_exchange" style="background-color: white;">
                <div class="inner" style="border-top: 1px solid #dcdcdc;border-bottom: 1px solid #dcdcdc">
                    <div class="title" style="padding-top: 0.8rem;">
                        <h1>兑换</h1>
                    </div>
                    <div class="con clearfix">
                        <div class="home_select_type">
                            <span class="fz16">手机号码</span>
                            <input type="text" value="" name="chargePhone" id="chargePhone"/>
                        </div>
                        <div class="home_select_type">
                            <span class="cm fz16">串  码</span>
                            <input type="text" value="" name="chargeNo" />
                        </div>
                        <div class="home_select_type">
                            <span class="fz16">选择金额</span>
                            <select name="mobile" id="chargeMoney">
                            </select>
                        </div>
                    </div>
                    <div class="textcenter" style="padding-bottom: 0.8rem;">
                        <a href="javascript:void(0)" class="submitbtn" >提交</a>
                    </div>
                </div>
            </div>
            <!--<div class="home_infolist mt25 mb10">
                <div class="inner home_top_con clearfix" id="exchange">
                    <span class="home_leftcon fl change">兑换</span>
                    <div class="changeinfo fr">
                        <input type="text" placeholder="输入串码(发送短信可接收串码)" class="point" name="chargeNo" />
                        <a href="javascript:void(0)" class="submitbtn" >提交</a>
                    </div>
                </div>
            </div>-->
            <div class="home_infolist mt5 mb5" style="border-top: 1px solid #dcdcdc;border-bottom: 1px solid #dcdcdc">
                <a href="javascript:location.href='integral_query.html?channelId='+$.func.getUrlParam('channelId')" class="ablock">
                    <div class="inner home_top_con clearfix">
                        <span class="home_leftcon fl fz16">积分查询</span>
                        <i class="home_rightico fr"></i>
                    </div>
                </a>
            </div>
            <div class="home_infolist mb5" style="border-top: 1px solid #dcdcdc;border-bottom: 1px solid #dcdcdc">
                <a href="javascript:location.href='order_query.html?channelId='+$.func.getUrlParam('channelId')" class="ablock">
                    <div class="inner home_top_con clearfix">
                        <span class="home_leftcon fl bind fz16">订单查询</span>
                        <i class="home_rightico fr"></i>
                    </div>
                </a>
            </div>
            <div class="home_infolist mb5" style="border-top: 1px solid #dcdcdc;border-bottom: 1px solid #dcdcdc">
                <a href="javascript:location.href='order_query.html?channelId='+$.func.getUrlParam('channelId')" class="ablock">
                    <div class="inner home_top_con clearfix">
                        <span class="home_leftcon fl help fz16">帮助中心</span>
                        <i class="home_rightico fr"></i>
                    </div>
                </a>
            </div>
            <!--<div style="height:50px;"></div>-->
        </div>
        <div class="tips" style="display:none">
            <div class="tips_des">
                <h1 id="chargeStatus">兑换失败</h1>
                <p id="chargeTips">请重新发送短信</p>
                <span class="closed"></span>
            </div>
        </div>
        <script type="text/html" id="tpl">
            <div link="{#link#}" class="product" style="width: 33.3%;float: left;">
                <dl>
                    <dt><img src="{#img#}"/></dt>
                    <dd class="items_price">{#exchangePrice#} 换呗</dd>
                    <dd class='productName'>{#productName#}</dd>
                </dl>
            </div>
        </script>
        <script type="text/html" id="mtpl">
        <option value="{##}">20.0</option>
    </script>
    <script type="text/javascript">
        if (!$.func.getCookie('phone')) {
            location.href = 'login.html?channelId=' + $.func.getUrlParam('channelId');
        }
        $('#nickName').html($.func.getCookie('phone'));
        var src = $.func.getCookie('headImgUrl') === null ? $.func.getCookie('headImgUrl') : '../images/tx.png';
        $('#avatar').attr('src', src);
        $.func.homePageProduct();

        $('.submitbtn').on('click', function () {
            var chargePhone = $('input[name="chargePhone"]').val();
            if (!chargePhone) {
                alert('请填写手机');
                return;
            }
            var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
            if (!reg.test(chargePhone)) {
                alert('请填写正确的手机号码');
                return;
            }
            var chargeNo = $('input[name="chargeNo"]').val();
            console.log(chargeNo);
            if (!chargeNo) {
                alert('请填写串码');
                return;
            }
            var chargeMoney = $('select').val();
            $.func.chargeNo(chargePhone, chargeNo, chargeMoney);
        });

        $('.closed').on('click', function () {
            $('.tips').hide();
        });

        // 输入手机号码超过11位，异步加载可兑换金额
        $(function () {
            $('#chargePhone').bind('input propertychange', function () {
                //alert($(this).val());
                if ($(this).val().length >= 11) {
                    var reg = /^0?1[3|4|5|7|8][0-9]\d{8}$/;
                    if (!reg.test($(this).val())) {
                        alert('请填写正确的手机号码');
                        return;
                    }
                    //获取可兑换金额
                    $.func.chargeMoney($(this).val());
                }
            });
        });
    </script>
</body>
</html>
